<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>多模态交互系统</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <header>
        <div class="container">
            <h1>多模态交互系统</h1>
        </div>
    </header>
    
    <nav>
        <div class="container">
            <ul>
                <li><a href="{{ url_for('index') }}" class="active">首页</a></li>
                <li><a href="{{ url_for('system_bp.logs') }}">交互日志</a></li>
                <li><a href="{{ url_for('auth.logout') }}">退出登录</a></li>
            </ul>
        </div>
    </nav>
    
    <div class="container">
        <div class="modal-content">
            <h2>欢迎, {{ current_user.username }}!</h2>
            <p>您当前的角色是: {{ current_user.role }}</p>

            <div class="shortcuts">
                <h3>系统功能</h3>
                <div class="shortcut-grid">
                    <a href="{{ url_for('system_bp.logs') }}" class="shortcut-item">
                        <h4>交互日志</h4>
                        <p>查看历史交互记录</p>
                    </a>
                </div>
            </div>

            <!-- 上传视频区域 -->
            <div class="upload-section">
                <h3>上传视频进行处理</h3>
                <form id="video-upload-form">
                    <input type="file" name="video" id="video-file" accept="video/*" required>
                    <button type="submit">上传并处理</button>
                </form>
                <pre id="json-output" style="margin-top: 1em; background: #f5f5f5; padding: 10px;"></pre>
            </div>
        </div>
    </div>

    <script>
    document.getElementById('video-upload-form').addEventListener('submit', async function (e) {
        e.preventDefault();
        const fileInput = document.getElementById('video-file');
        const output = document.getElementById('json-output');
        const formData = new FormData();
        formData.append('video', fileInput.files[0]);

        output.textContent = '处理中...';

        try {
            const response = await fetch('{{ url_for("system_bp.control") }}', {
                method: 'POST',
                body: formData
            });
            const result = await response.json();
            output.textContent = JSON.stringify(result, null, 4);
        } catch (error) {
            output.textContent = '请求失败: ' + error;
        }
    });
    </script>
</body>
</html>
